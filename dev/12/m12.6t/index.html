<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>m12.6t Â· TuringModels.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>TuringModels.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../intro/">Home</a></li><li><span class="toctext">Chapter 02</span><ul><li><a class="toctext" href="../../02/m2.1t/">m2.1t</a></li></ul></li><li><span class="toctext">Chapter 04</span><ul><li><a class="toctext" href="../../04/m4.2t/">m4.2t</a></li></ul></li><li><span class="toctext">Chapter 08</span><ul><li><a class="toctext" href="../../08/m8.1t/">m8.1t</a></li><li><a class="toctext" href="../../08/m8.4t/">m8.4t</a></li></ul></li><li><span class="toctext">Chapter 10</span><ul><li><a class="toctext" href="../../10/m10.04t/">m10.04t</a></li></ul></li><li><span class="toctext">Chapter 11</span></li><li><span class="toctext">Chapter 12</span><ul><li class="current"><a class="toctext" href>m12.6t</a><ul class="internal"></ul></li></ul></li><li><a class="toctext" href="../../">Functions</a></li></ul></nav><article id="docs"><header><nav><ul><li>Chapter 12</li><li><a href>m12.6t</a></li></ul><a class="edit-page" href="https://github.com/StatisticalRethinkingJulia/TuringModels.jl/blob/master/docs/src/12/m12.6t.md"><span class="fa">ï‚›</span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>m12.6t</span><a class="fa fa-bars" href="#"></a></div></header><pre><code class="language-julia">using TuringModels

Turing.setadbackend(:reverse_diff)
Turing.turnprogress(false)

d = CSV.read(rel_path(&quot;..&quot;, &quot;data&quot;, &quot;Kline.csv&quot;), delim=&#39;;&#39;);
size(d) # Should be 10x5</code></pre><pre><code class="language-none">â”Œ Info: [Turing]: global PROGRESS is set as false
â”” @ Turing /Users/rob/.julia/packages/Turing/r03H1/src/Turing.jl:24





(10, 5)</code></pre><p>New col log_pop, set log() for population data</p><pre><code class="language-julia">d[:log_pop] = map((x) -&gt; log(x), d[:population]);
d[:society] = 1:10;</code></pre><p>Turing model</p><pre><code class="language-julia">@model m12_6(total_tools, log_pop, society) = begin
    # Total num of y
    N = length(total_tools)
    # priors
    Î± ~ Normal(0, 10)
    Î²p ~ Normal(0, 1)
    # Separate Ïƒ priors for each society
    Ïƒ_society ~ Truncated(Cauchy(0, 1), 0, Inf)
    # Number of unique societies in the data set
    N_society = length(unique(society)) #10
    # Vector of societies (1,..,10) which we&#39;ll set priors on
    Î±_society = Vector{Real}(undef, N_society)
    # For each society [1,..,10] set a prior N(0, Ïƒ_society)
    Î±_society ~ [Normal(0, Ïƒ_society)]

    for i âˆˆ 1:N
        Î» = exp(Î± + Î±_society[society[i]] + Î²p*log_pop[i])
        total_tools[i] ~ Poisson(Î»)
    end
end</code></pre><pre><code class="language-none">m12_6 (generic function with 4 methods)</code></pre><p>Sample</p><pre><code class="language-julia">posterior = sample(m12_6(d[:total_tools], d[:log_pop],
    d[:society]), Turing.NUTS(4000, 1000, 0.95));
# Fix the inclusion of adaptation samples
draws = 1001:4000
posterior2 = Chains(posterior[draws,:,:], :parameters)</code></pre><pre><code class="language-none">â”Œ Info: [Turing] looking for good initial eps...
â”” @ Turing.Inference /Users/rob/.julia/packages/Turing/r03H1/src/inference/support/hmc_core.jl:240
â”Œ Warning: Numerical error has been found in gradients.
â”” @ Turing.Core /Users/rob/.julia/packages/Turing/r03H1/src/core/ad.jl:169
â”Œ Warning: grad = [NaN, NaN, 3.975875826723833e81, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN]
â”” @ Turing.Core /Users/rob/.julia/packages/Turing/r03H1/src/core/ad.jl:170
â”Œ Warning: Numerical error has been found in gradients.
â”” @ Turing.Core /Users/rob/.julia/packages/Turing/r03H1/src/core/ad.jl:169
â”Œ Warning: grad = [NaN, NaN, 1.5404851023330582e36, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN]
â”” @ Turing.Core /Users/rob/.julia/packages/Turing/r03H1/src/core/ad.jl:170
[NUTS{Turing.Core.FluxTrackerAD,Union{}}] found initial Ïµ: 0.0125
â”” @ Turing.Inference /Users/rob/.julia/packages/Turing/r03H1/src/inference/support/hmc_core.jl:235
â”Œ Info:  Adapted Ïµ = 0.004603497304111276, std = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]; 1000 iterations is used for adaption.
â”” @ Turing.Inference /Users/rob/.julia/packages/Turing/r03H1/src/inference/adapt/adapt.jl:91


[NUTS] Finished with
  Running time        = 196.16798833699977;
  #lf / sample        = 0.0;
  #evals / sample     = 189.32975;
  pre-cond. metric    = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0,....





Object of type Chains, with data of type 3000Ã—13Ã—1 Array{Union{Missing, Float64},3}

Log evidence      = 0.0
Iterations        = 1001:4000
Thinning interval = 1
Chains            = Chain1
Samples per chain = 3000
parameters        = Î±_society[5], Î±_society[9], Î±_society[3], Î±_society[6], Î±_society[8], Î±_society[1], Î²p, Î±_society[10], Ïƒ_society, Î±, Î±_society[2], Î±_society[4], Î±_society[7]

parameters
                Mean    SD   Naive SE  MCSE     ESS  
            Î±  1.0131 0.8098   0.0148 0.1170  47.9312
 Î±_society[1] -0.1869 0.2628   0.0048 0.0274  91.8357
 Î±_society[2]  0.0725 0.2366   0.0043 0.0222 113.4874
 Î±_society[3] -0.0192 0.2089   0.0038 0.0160 171.3097
 Î±_society[4]  0.3666 0.2069   0.0038 0.0180 131.4825
 Î±_society[5]  0.0727 0.1925   0.0035 0.0126 232.8379
 Î±_society[6] -0.3322 0.2107   0.0038 0.0131 258.9057
 Î±_society[7]  0.1750 0.1813   0.0033 0.0110 273.2586
 Î±_society[8] -0.1702 0.1895   0.0035 0.0089 455.1627
 Î±_society[9]  0.2971 0.1775   0.0032 0.0089 397.5320
Î±_society[10] -0.1077 0.2929   0.0053 0.0340  74.0449
           Î²p  0.2685 0.0857   0.0016 0.0122  49.1601
    Ïƒ_society  0.3309 0.1184   0.0022 0.0120  97.7657</code></pre><p>Results rethinking</p><pre><code class="language-julia">m126rethinking = &quot;
              Mean StdDev lower 0.89 upper 0.89 n_eff Rhat
a              1.11   0.75      -0.05       2.24  1256    1
bp             0.26   0.08       0.13       0.38  1276    1
a_society[1]  -0.20   0.24      -0.57       0.16  2389    1
a_society[2]   0.04   0.21      -0.29       0.38  2220    1
a_society[3]  -0.05   0.19      -0.36       0.25  3018    1
a_society[4]   0.32   0.18       0.01       0.60  2153    1
a_society[5]   0.04   0.18      -0.22       0.33  3196    1
a_society[6]  -0.32   0.21      -0.62       0.02  2574    1
a_society[7]   0.14   0.17      -0.13       0.40  2751    1
a_society[8]  -0.18   0.19      -0.46       0.12  2952    1
a_society[9]   0.27   0.17      -0.02       0.52  2540    1
a_society[10] -0.10   0.30      -0.52       0.37  1433    1
sigma_society  0.31   0.13       0.11       0.47  1345    1
&quot;;</code></pre><p>Describe the posterior samples</p><pre><code class="language-julia">describe(posterior2)

cnames = [
  :Î±,:Î±_society_1, :Î±_society_2, :Î±_society_3,
  :Î±_society_4, :Î±_society_5, :Î±_society_6,
  :Î±_society_7, :Î±_society_8,:Î±_society_9,
  :Î±_society_10, :Î²p, :Ïƒ_society
]

df = DataFrame(convert(Matrix{Float64}, to_df(posterior2)), cnames)
first(df, 5)</code></pre><pre><code class="language-none">Log evidence      = 0.0
Iterations        = 1001:4000
Thinning interval = 1
Chains            = Chain1
Samples per chain = 3000
parameters        = Î±_society[5], Î±_society[9], Î±_society[3], Î±_society[6], Î±_society[8], Î±_society[1], Î²p, Î±_society[10], Ïƒ_society, Î±, Î±_society[2], Î±_society[4], Î±_society[7]



â”Œ Warning: `quantile(v::AbstractArray{&lt;:Real})` is deprecated, use `quantile(v, [0.0, 0.25, 0.5, 0.75, 1.0])` instead.
â”‚   caller = (::getfield(MCMCChains, Symbol(&quot;##102#104&quot;)){Chains{Union{Missing, Float64},Float64,NamedTuple{(:parameters,),Tuple{Array{String,1}}},NamedTuple{(:hashedsummary,),Tuple{Base.RefValue{Tuple{UInt64,MCMCChains.ChainSummaries}}}}}})(::String) at none:0
â”” @ MCMCChains ./none:0


[36m[1mEmpirical Posterior Estimates[22m[39m
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
parameters
                Mean    SD   Naive SE  MCSE     ESS  
            Î±  1.0131 0.8098   0.0148 0.1170  47.9312
 Î±_society[1] -0.1869 0.2628   0.0048 0.0274  91.8357
 Î±_society[2]  0.0725 0.2366   0.0043 0.0222 113.4874
 Î±_society[3] -0.0192 0.2089   0.0038 0.0160 171.3097
 Î±_society[4]  0.3666 0.2069   0.0038 0.0180 131.4825
 Î±_society[5]  0.0727 0.1925   0.0035 0.0126 232.8379
 Î±_society[6] -0.3322 0.2107   0.0038 0.0131 258.9057
 Î±_society[7]  0.1750 0.1813   0.0033 0.0110 273.2586
 Î±_society[8] -0.1702 0.1895   0.0035 0.0089 455.1627
 Î±_society[9]  0.2971 0.1775   0.0032 0.0089 397.5320
Î±_society[10] -0.1077 0.2929   0.0053 0.0340  74.0449
           Î²p  0.2685 0.0857   0.0016 0.0122  49.1601
    Ïƒ_society  0.3309 0.1184   0.0022 0.0120  97.7657

[36m[1mQuantiles[22m[39m
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
parameters
                2.5%   25.0%   50.0%   75.0%   97.5%
            Î± -1.9097  0.5650  1.1230  1.5701 2.9674
 Î±_society[1] -0.9649 -0.3578 -0.1898 -0.0308 0.8134
 Î±_society[2] -0.7020 -0.0856  0.0478  0.2050 1.1970
 Î±_society[3] -0.7583 -0.1486 -0.0274  0.1092 0.7739
 Î±_society[4] -0.2466  0.2232  0.3541  0.4903 1.1594
 Î±_society[5] -0.6097 -0.0515  0.0675  0.1932 0.7374
 Î±_society[6] -1.1308 -0.4671 -0.3199 -0.1882 0.5029
 Î±_society[7] -0.4311  0.0523  0.1669  0.2836 0.9332
 Î±_society[8] -0.7607 -0.2923 -0.1698 -0.0388 0.5453
 Î±_society[9] -0.4227  0.1762  0.2881  0.4116 0.9183
Î±_society[10] -1.1368 -0.2898 -0.0896  0.0916 0.7851
           Î²p  0.0498  0.2081  0.2575  0.3182 0.5793
    Ïƒ_society  0.0436  0.2467  0.3137  0.3965 1.1329</code></pre><p>&lt;table class=&quot;data-frame&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;Î±&lt;/th&gt;&lt;th&gt;Î±<em>society</em>1&lt;/th&gt;&lt;th&gt;Î±<em>society</em>2&lt;/th&gt;&lt;th&gt;Î±<em>society</em>3&lt;/th&gt;&lt;th&gt;Î±<em>society</em>4&lt;/th&gt;&lt;th&gt;Î±<em>society</em>5&lt;/th&gt;&lt;th&gt;Î±<em>society</em>6&lt;/th&gt;&lt;th&gt;Î±<em>society</em>7&lt;/th&gt;&lt;th&gt;Î±<em>society</em>8&lt;/th&gt;&lt;th&gt;Î±<em>society</em>9&lt;/th&gt;&lt;th&gt;Î±<em>society</em>10&lt;/th&gt;&lt;th&gt;Î²p&lt;/th&gt;&lt;th&gt;Ïƒ_society&lt;/th&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;Float64&lt;/th&gt;&lt;th&gt;Float64&lt;/th&gt;&lt;th&gt;Float64&lt;/th&gt;&lt;th&gt;Float64&lt;/th&gt;&lt;th&gt;Float64&lt;/th&gt;&lt;th&gt;Float64&lt;/th&gt;&lt;th&gt;Float64&lt;/th&gt;&lt;th&gt;Float64&lt;/th&gt;&lt;th&gt;Float64&lt;/th&gt;&lt;th&gt;Float64&lt;/th&gt;&lt;th&gt;Float64&lt;/th&gt;&lt;th&gt;Float64&lt;/th&gt;&lt;th&gt;Float64&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;p&gt;5 rows Ã— 13 columns&lt;/p&gt;&lt;tr&gt;&lt;th&gt;1&lt;/th&gt;&lt;td&gt;0.468659&lt;/td&gt;&lt;td&gt;0.0997899&lt;/td&gt;&lt;td&gt;0.0627841&lt;/td&gt;&lt;td&gt;0.131921&lt;/td&gt;&lt;td&gt;0.18443&lt;/td&gt;&lt;td&gt;0.0221748&lt;/td&gt;&lt;td&gt;-0.117291&lt;/td&gt;&lt;td&gt;0.189045&lt;/td&gt;&lt;td&gt;-0.257996&lt;/td&gt;&lt;td&gt;0.203787&lt;/td&gt;&lt;td&gt;-0.218552&lt;/td&gt;&lt;td&gt;0.319401&lt;/td&gt;&lt;td&gt;0.217443&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th&gt;2&lt;/th&gt;&lt;td&gt;0.586306&lt;/td&gt;&lt;td&gt;0.0517588&lt;/td&gt;&lt;td&gt;0.0721921&lt;/td&gt;&lt;td&gt;0.12386&lt;/td&gt;&lt;td&gt;0.126687&lt;/td&gt;&lt;td&gt;0.00442691&lt;/td&gt;&lt;td&gt;-0.0824298&lt;/td&gt;&lt;td&gt;0.174092&lt;/td&gt;&lt;td&gt;-0.202191&lt;/td&gt;&lt;td&gt;0.21546&lt;/td&gt;&lt;td&gt;-0.178376&lt;/td&gt;&lt;td&gt;0.312929&lt;/td&gt;&lt;td&gt;0.209458&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th&gt;3&lt;/th&gt;&lt;td&gt;0.687747&lt;/td&gt;&lt;td&gt;0.0621691&lt;/td&gt;&lt;td&gt;0.160311&lt;/td&gt;&lt;td&gt;-0.352538&lt;/td&gt;&lt;td&gt;0.432242&lt;/td&gt;&lt;td&gt;0.0729015&lt;/td&gt;&lt;td&gt;-0.32996&lt;/td&gt;&lt;td&gt;0.118331&lt;/td&gt;&lt;td&gt;-0.343966&lt;/td&gt;&lt;td&gt;0.29101&lt;/td&gt;&lt;td&gt;-0.123686&lt;/td&gt;&lt;td&gt;0.304788&lt;/td&gt;&lt;td&gt;0.194923&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th&gt;4&lt;/th&gt;&lt;td&gt;0.713992&lt;/td&gt;&lt;td&gt;0.0974287&lt;/td&gt;&lt;td&gt;0.22961&lt;/td&gt;&lt;td&gt;0.167159&lt;/td&gt;&lt;td&gt;0.280534&lt;/td&gt;&lt;td&gt;0.159729&lt;/td&gt;&lt;td&gt;-0.141922&lt;/td&gt;&lt;td&gt;0.0661826&lt;/td&gt;&lt;td&gt;-0.0955419&lt;/td&gt;&lt;td&gt;-0.0728205&lt;/td&gt;&lt;td&gt;-0.0705672&lt;/td&gt;&lt;td&gt;0.306378&lt;/td&gt;&lt;td&gt;0.179783&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th&gt;5&lt;/th&gt;&lt;td&gt;0.774082&lt;/td&gt;&lt;td&gt;0.13936&lt;/td&gt;&lt;td&gt;0.256276&lt;/td&gt;&lt;td&gt;0.129645&lt;/td&gt;&lt;td&gt;0.285317&lt;/td&gt;&lt;td&gt;-0.0341815&lt;/td&gt;&lt;td&gt;-0.220036&lt;/td&gt;&lt;td&gt;0.219055&lt;/td&gt;&lt;td&gt;0.0609183&lt;/td&gt;&lt;td&gt;0.0107175&lt;/td&gt;&lt;td&gt;-0.079961&lt;/td&gt;&lt;td&gt;0.28998&lt;/td&gt;&lt;td&gt;0.146416&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;</p><p>End of m12.6t.jl</p><p><em>This notebook was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p><footer><hr/><a class="previous" href="../../10/m10.04t/"><span class="direction">Previous</span><span class="title">m10.04t</span></a><a class="next" href="../../"><span class="direction">Next</span><span class="title">Functions</span></a></footer></article></body></html>
