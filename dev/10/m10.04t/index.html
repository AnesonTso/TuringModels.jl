<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>m10.04t · TuringModels.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>TuringModels.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../intro/">Home</a></li><li><span class="toctext">Chapter 02</span><ul><li><a class="toctext" href="../../02/m2.1t/">m2.1t</a></li></ul></li><li><span class="toctext">Chapter 04</span><ul><li><a class="toctext" href="../../04/m4.2t/">m4.2t</a></li></ul></li><li><span class="toctext">Chapter 08</span><ul><li><a class="toctext" href="../../08/m8.1t/">m8.1t</a></li><li><a class="toctext" href="../../08/m8.4t/">m8.4t</a></li></ul></li><li><span class="toctext">Chapter 10</span><ul><li class="current"><a class="toctext" href>m10.04t</a><ul class="internal"></ul></li></ul></li><li><span class="toctext">Chapter 11</span></li><li><span class="toctext">Chapter 12</span><ul><li><a class="toctext" href="../../12/m12.6t/">m12.6t</a></li></ul></li><li><a class="toctext" href="../../">Functions</a></li></ul></nav><article id="docs"><header><nav><ul><li>Chapter 10</li><li><a href>m10.04t</a></li></ul><a class="edit-page" href="https://github.com/StatisticalRethinkingJulia/TuringModels.jl/blob/master/docs/src/10/m10.04t.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>m10.04t</span><a class="fa fa-bars" href="#"></a></div></header><pre><code class="language-julia">using TuringModels

Turing.setadbackend(:reverse_diff);
Turing.turnprogress(false);

d = CSV.read(rel_path(&quot;..&quot;, &quot;data&quot;, &quot;chimpanzees.csv&quot;), delim=&#39;;&#39;);
size(d) # Should be 504x8</code></pre><pre><code class="language-none">┌ Info: [Turing]: global PROGRESS is set as false
└ @ Turing /Users/rob/.julia/packages/Turing/r03H1/src/Turing.jl:24





(504, 8)</code></pre><p>pulled<em>left, actors, condition, prosoc</em>left</p><pre><code class="language-julia">@model m10_4(y, actors, x₁, x₂) = begin
    # Number of unique actors in the data set
    N_actor = length(unique(actors))
    # Set an TArray for the priors/param
    α = TArray{Any}(undef, N_actor)
    # For each actor [1,..,7] set a prior
    for i ∈ 1:length(α)
        α[i] ~ Normal(0,10)
    end

    βp ~ Normal(0, 10)
    βpC ~ Normal(0, 10)

    for i ∈ 1:length(y)
        p = logistic(α[actors[i]] + (βp + βpC * x₁[i]) * x₂[i])
        y[i] ~ Binomial(1, p)
    end
end;

posterior = sample(m10_4(d[:,:pulled_left], d[:,:actor],d[:,:condition],
d[:,:prosoc_left]), Turing.NUTS(2000, 1000, 0.95));</code></pre><pre><code class="language-none">┌ Info: [Turing] looking for good initial eps...
└ @ Turing.Inference /Users/rob/.julia/packages/Turing/r03H1/src/inference/support/hmc_core.jl:240
[NUTS{Turing.Core.FluxTrackerAD,Union{}}] found initial ϵ: 0.4
└ @ Turing.Inference /Users/rob/.julia/packages/Turing/r03H1/src/inference/support/hmc_core.jl:235
┌ Warning: Numerical error has been found in gradients.
└ @ Turing.Core /Users/rob/.julia/packages/Turing/r03H1/src/core/ad.jl:169
┌ Warning: grad = [NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN]
└ @ Turing.Core /Users/rob/.julia/packages/Turing/r03H1/src/core/ad.jl:170
┌ Info:  Adapted ϵ = 0.09340741377838617, std = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]; 1000 iterations is used for adaption.
└ @ Turing.Inference /Users/rob/.julia/packages/Turing/r03H1/src/inference/adapt/adapt.jl:91
┌ Warning: Numerical error has been found in gradients.
└ @ Turing.Core /Users/rob/.julia/packages/Turing/r03H1/src/core/ad.jl:169
┌ Warning: grad = [-1.413683823692169, NaN, -0.0053143216643326, 6.180638719948819, 5.7481680727318825, 1.2802685894642976, 2.4636098718763173, NaN, NaN]
└ @ Turing.Core /Users/rob/.julia/packages/Turing/r03H1/src/core/ad.jl:170


[NUTS] Finished with
  Running time        = 1036.9406298429983;
  #lf / sample        = 0.0;
  #evals / sample     = 67.339;
  pre-cond. metric    = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0,....</code></pre><p>Fix the inclusion of adaptation samples</p><pre><code class="language-julia">draws = 1001:2000
posterior2 = Chains(posterior[draws,:,:], :parameters)</code></pre><pre><code class="language-none">Object of type Chains, with data of type 1000×9×1 Array{Union{Missing, Float64},3}

Log evidence      = 0.0
Iterations        = 1001:2000
Thinning interval = 1
Chains            = Chain1
Samples per chain = 1000
parameters        = α[2], βpC, βp, α[7], α[4], α[6], α[5], α[3], α[1]

parameters
       Mean    SD   Naive SE  MCSE     ESS   
α[1] -0.7368 0.2626   0.0083 0.0096  743.4117
α[2] 11.1931 5.4292   0.1717 0.8311   42.6710
α[3] -1.0455 0.2848   0.0090 0.0076 1000.0000
α[4] -1.0465 0.2808   0.0089 0.0065 1000.0000
α[5] -0.7435 0.2715   0.0086 0.0084 1000.0000
α[6]  0.2216 0.2738   0.0087 0.0065 1000.0000
α[7]  1.8233 0.3832   0.0121 0.0146  692.2298
  βp  0.8450 0.2572   0.0081 0.0115  500.4234
 βpC -0.1528 0.2815   0.0089 0.0101  782.8304</code></pre><p>Rethinking/CmdStan results</p><pre><code class="language-julia">m_10_04s_result = &quot;
Iterations = 1:1000
Thinning interval = 1
Chains = 1,2,3,4
Samples per chain = 1000

Empirical Posterior Estimates:
        Mean        SD       Naive SE       MCSE      ESS
a.1 -0.74503184 0.26613979 0.0042080396 0.0060183398 1000
a.2 10.77955494 5.32538998 0.0842018089 0.1269148045 1000
a.3 -1.04982353 0.28535997 0.0045119373 0.0049074219 1000
a.4 -1.04898135 0.28129307 0.0044476339 0.0056325117 1000
a.5 -0.74390933 0.26949936 0.0042611590 0.0052178124 1000
a.6  0.21599365 0.26307574 0.0041595927 0.0045153523 1000
a.7  1.81090866 0.39318577 0.0062168129 0.0071483527 1000
bp  0.83979926 0.26284676 0.0041559722 0.0059795826 1000
bpC -0.12913322 0.29935741 0.0047332562 0.0049519863 1000
&quot;;</code></pre><p>Describe the draws</p><pre><code class="language-julia">describe(posterior2)</code></pre><pre><code class="language-none">Log evidence      = 0.0
Iterations        = 1001:2000
Thinning interval = 1
Chains            = Chain1
Samples per chain = 1000
parameters        = α[2], βpC, βp, α[7], α[4], α[6], α[5], α[3], α[1]



┌ Warning: `quantile(v::AbstractArray{&lt;:Real})` is deprecated, use `quantile(v, [0.0, 0.25, 0.5, 0.75, 1.0])` instead.
│   caller = (::getfield(MCMCChains, Symbol(&quot;##102#104&quot;)){Chains{Union{Missing, Float64},Float64,NamedTuple{(:parameters,),Tuple{Array{String,1}}},NamedTuple{(:hashedsummary,),Tuple{Base.RefValue{Tuple{UInt64,MCMCChains.ChainSummaries}}}}}})(::String) at none:0
└ @ MCMCChains ./none:0


[36m[1mEmpirical Posterior Estimates[22m[39m
─────────────────────────────────────────────
parameters
       Mean    SD   Naive SE  MCSE     ESS   
α[1] -0.7368 0.2626   0.0083 0.0096  743.4117
α[2] 11.1931 5.4292   0.1717 0.8311   42.6710
α[3] -1.0455 0.2848   0.0090 0.0076 1000.0000
α[4] -1.0465 0.2808   0.0089 0.0065 1000.0000
α[5] -0.7435 0.2715   0.0086 0.0084 1000.0000
α[6]  0.2216 0.2738   0.0087 0.0065 1000.0000
α[7]  1.8233 0.3832   0.0121 0.0146  692.2298
  βp  0.8450 0.2572   0.0081 0.0115  500.4234
 βpC -0.1528 0.2815   0.0089 0.0101  782.8304

[36m[1mQuantiles[22m[39m
─────────────────────────────────────────────
parameters
       2.5%   25.0%   50.0%   75.0%   97.5% 
α[1] -1.7078 -0.9135 -0.7309 -0.5709  0.1285
α[2]  3.0412  7.2461 10.0285 14.0184 31.8224
α[3] -2.1025 -1.2400 -1.0375 -0.8606 -0.1937
α[4] -2.0072 -1.2185 -1.0397 -0.8696 -0.0853
α[5] -1.5113 -0.9400 -0.7376 -0.5517  0.0889
α[6] -0.6183  0.0334  0.2297  0.4092  1.1575
α[7]  0.7556  1.5585  1.8237  2.0891  3.1643
  βp  0.1388  0.6579  0.8346  1.0279  1.6540
 βpC -0.9645 -0.3344 -0.1512  0.0349  0.6841</code></pre><p>Create a DataFrame</p><pre><code class="language-julia">cnames = [
  :a_1, :a_2, :a_3, :a_4, :a_5, :a_6, :a_7,
  :bp, :bpC
]

df = DataFrame(convert(Matrix{Float64}, to_df(posterior2)), cnames)
first(df, 5)</code></pre><p>&lt;table class=&quot;data-frame&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;a<em>1&lt;/th&gt;&lt;th&gt;a</em>2&lt;/th&gt;&lt;th&gt;a<em>3&lt;/th&gt;&lt;th&gt;a</em>4&lt;/th&gt;&lt;th&gt;a<em>5&lt;/th&gt;&lt;th&gt;a</em>6&lt;/th&gt;&lt;th&gt;a_7&lt;/th&gt;&lt;th&gt;bp&lt;/th&gt;&lt;th&gt;bpC&lt;/th&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;Float64&lt;/th&gt;&lt;th&gt;Float64&lt;/th&gt;&lt;th&gt;Float64&lt;/th&gt;&lt;th&gt;Float64&lt;/th&gt;&lt;th&gt;Float64&lt;/th&gt;&lt;th&gt;Float64&lt;/th&gt;&lt;th&gt;Float64&lt;/th&gt;&lt;th&gt;Float64&lt;/th&gt;&lt;th&gt;Float64&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;p&gt;5 rows × 9 columns&lt;/p&gt;&lt;tr&gt;&lt;th&gt;1&lt;/th&gt;&lt;td&gt;-1.0929&lt;/td&gt;&lt;td&gt;6.73563&lt;/td&gt;&lt;td&gt;-0.976573&lt;/td&gt;&lt;td&gt;-1.12526&lt;/td&gt;&lt;td&gt;-0.886459&lt;/td&gt;&lt;td&gt;0.322946&lt;/td&gt;&lt;td&gt;2.6305&lt;/td&gt;&lt;td&gt;0.850382&lt;/td&gt;&lt;td&gt;-0.395548&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th&gt;2&lt;/th&gt;&lt;td&gt;-0.431177&lt;/td&gt;&lt;td&gt;6.35147&lt;/td&gt;&lt;td&gt;-1.23014&lt;/td&gt;&lt;td&gt;-1.1136&lt;/td&gt;&lt;td&gt;-0.704243&lt;/td&gt;&lt;td&gt;-0.0204245&lt;/td&gt;&lt;td&gt;1.48751&lt;/td&gt;&lt;td&gt;0.558974&lt;/td&gt;&lt;td&gt;0.0371371&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th&gt;3&lt;/th&gt;&lt;td&gt;-0.732745&lt;/td&gt;&lt;td&gt;4.9389&lt;/td&gt;&lt;td&gt;-0.913287&lt;/td&gt;&lt;td&gt;-1.05535&lt;/td&gt;&lt;td&gt;-0.778746&lt;/td&gt;&lt;td&gt;0.569156&lt;/td&gt;&lt;td&gt;2.39251&lt;/td&gt;&lt;td&gt;0.942476&lt;/td&gt;&lt;td&gt;-0.376117&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th&gt;4&lt;/th&gt;&lt;td&gt;-0.647605&lt;/td&gt;&lt;td&gt;4.52435&lt;/td&gt;&lt;td&gt;-0.908345&lt;/td&gt;&lt;td&gt;-0.982594&lt;/td&gt;&lt;td&gt;-0.555483&lt;/td&gt;&lt;td&gt;-0.234643&lt;/td&gt;&lt;td&gt;1.56546&lt;/td&gt;&lt;td&gt;1.02727&lt;/td&gt;&lt;td&gt;-0.187141&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th&gt;5&lt;/th&gt;&lt;td&gt;-0.518945&lt;/td&gt;&lt;td&gt;8.02371&lt;/td&gt;&lt;td&gt;-1.03367&lt;/td&gt;&lt;td&gt;-0.914572&lt;/td&gt;&lt;td&gt;-0.562902&lt;/td&gt;&lt;td&gt;-0.145583&lt;/td&gt;&lt;td&gt;2.15204&lt;/td&gt;&lt;td&gt;0.586953&lt;/td&gt;&lt;td&gt;-0.084613&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;</p><p>End of 10/m<em>10</em>04t.jl#- <em>This notebook was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p><footer><hr/><a class="previous" href="../../08/m8.4t/"><span class="direction">Previous</span><span class="title">m8.4t</span></a><a class="next" href="../../12/m12.6t/"><span class="direction">Next</span><span class="title">m12.6t</span></a></footer></article></body></html>
